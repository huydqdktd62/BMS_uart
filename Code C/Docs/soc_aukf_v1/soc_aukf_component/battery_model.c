/*
 * model.c
 *
 *  Created on: Jul 1, 2022
 *      Author: ADMIN
 */

#if 0
#include "battery_model.h"
#include "math_lib.h"

static const float ocv_lut_values[MODEL_OCV_LUT_SIZE] = {
		4.1700f, 4.1595f,
		4.1502f, 4.1421f, 4.1347f, 4.1269f, 4.1210f, 4.1158f, 4.1108f, 4.1068f,
		4.1034f, 4.1003f, 4.0975f, 4.0950f, 4.0928f, 4.0910f, 4.0888f, 4.0873f,
		4.0857f, 4.0850f, 4.0832f, 4.0820f, 4.0807f, 4.0798f, 4.0786f, 4.0776f,
		4.0764f, 4.0752f, 4.0733f, 4.0714f, 4.0696f, 4.0671f, 4.0643f, 4.0612f,
		4.0575f, 4.0538f, 4.0491f, 4.0448f, 4.0401f, 4.0352f, 4.0299f, 4.0243f,
		4.0187f, 4.0128f, 4.0066f, 4.0004f, 3.9942f, 3.9887f, 3.9825f, 3.9769f,
		3.9713f, 3.9657f, 3.9605f, 3.9558f, 3.9508f, 3.9462f, 3.9419f, 3.9375f,
		3.9338f, 3.9317f, 3.9295f, 3.9260f, 3.9220f, 3.9186f, 3.9149f, 3.9115f,
		3.9084f, 3.9046f, 3.9012f, 3.8975f, 3.8944f, 3.8904f, 3.8867f, 3.8826f,
		3.8786f, 3.8743f, 3.8705f, 3.8659f, 3.8619f, 3.8569f, 3.8523f, 3.8473f,
		3.8423f, 3.8368f, 3.8312f, 3.8253f, 3.8188f, 3.8116f, 3.8045f, 3.7968f,
		3.7893f, 3.7816f, 3.7748f, 3.7679f, 3.7611f, 3.7552f, 3.7493f, 3.7437f,
		3.7382f, 3.7326f, 3.7276f, 3.7227f, 3.7201f, 3.7174f, 3.7131f, 3.7081f,
		3.7038f, 3.6991f, 3.6948f, 3.6907f, 3.6864f, 3.6827f, 3.6786f, 3.6752f,
		3.6718f, 3.6681f, 3.6650f, 3.6613f, 3.6585f, 3.6551f, 3.6523f, 3.6492f,
		3.6461f, 3.6436f, 3.6408f, 3.6377f, 3.6352f, 3.6328f, 3.6300f, 3.6275f,
		3.6247f, 3.6219f, 3.6194f, 3.6166f, 3.6135f, 3.6111f, 3.6086f, 3.6055f,
		3.6027f, 3.6010f, 3.5993f, 3.5965f, 3.5934f, 3.5897f, 3.5866f, 3.5825f,
		3.5788f, 3.5745f, 3.5701f, 3.5658f, 3.5621f, 3.5580f, 3.5540f, 3.5497f,
		3.5450f, 3.5410f, 3.5363f, 3.5320f, 3.5274f, 3.5230f, 3.5184f, 3.5140f,
		3.5094f, 3.5050f, 3.5007f, 3.4957f, 3.4908f, 3.4852f, 3.4790f, 3.4728f,
		3.4666f, 3.4601f, 3.4542f, 3.4480f, 3.4415f, 3.4347f, 3.4281f, 3.4210f,
		3.4181f, 3.4151f, 3.4099f, 3.4055f, 3.4012f, 3.3975f, 3.3934f, 3.3894f,
		3.3851f, 3.3813f, 3.3767f, 3.3723f, 3.3671f, 3.3612f, 3.3531f, 3.3413f,
		3.3227f, 3.3007f, 3.2762f, 3.2490f, 3.2189f, 3.1857f
//		, 3.1679f

};

static const float soc_lut_values[MODEL_SOC_LUT_SIZE] = {
		100.0f, 99.5f,
		99.0f, 98.5f, 98.0f, 97.5f, 97.0f, 96.5f, 96.0f, 95.5f, 95.0f, 94.5f,
		94.0f, 93.5f, 93.0f, 92.5f, 92.0f, 91.5f, 91.0f, 90.5f, 90.0f, 89.5f,
		89.0f, 88.5f, 88.0f, 87.5f, 87.0f, 86.5f, 86.0f, 85.5f, 85.0f, 84.5f,
		84.0f, 83.5f, 83.0f, 82.5f, 82.0f, 81.5f, 81.0f, 80.5f, 80.0f, 79.5f,
		79.0f, 78.5f, 78.0f, 77.5f, 77.0f, 76.5f, 76.0f, 75.5f, 75.0f, 74.5f,
		74.0f, 73.5f, 73.0f, 72.5f, 72.0f, 71.5f, 71.0f, 70.5f, 70.0f, 69.5f,
		69.0f, 68.5f, 68.0f, 67.5f, 67.0f, 66.5f, 66.0f, 65.5f, 65.0f, 64.5f,
		64.0f, 63.5f, 63.0f, 62.5f, 62.0f, 61.5f, 61.0f, 60.5f, 60.0f, 59.5f,
		59.0f, 58.5f, 58.0f, 57.5f, 57.0f, 56.5f, 56.0f, 55.5f, 55.0f, 54.5f,
		54.0f, 53.5f, 53.0f, 52.5f, 52.0f, 51.5f, 51.0f, 50.5f, 50.0f, 49.5f,
		49.0f, 48.5f, 48.0f, 47.5f, 47.0f, 46.5f, 46.0f, 45.5f, 45.0f, 44.5f,
		44.0f, 43.5f, 43.0f, 42.5f, 42.0f, 41.5f, 41.0f, 40.5f, 40.0f, 39.5f,
		39.0f, 38.5f, 38.0f, 37.5f, 37.0f, 36.5f, 36.0f, 35.5f, 35.0f, 34.5f,
		34.0f, 33.5f, 33.0f, 32.5f, 32.0f, 31.5f, 31.0f, 30.5f, 30.0f, 29.5f,
		29.0f, 28.5f, 28.0f, 27.5f, 27.0f, 26.5f, 26.0f, 25.5f, 25.0f, 24.5f,
		24.0f, 23.5f, 23.0f, 22.5f, 22.0f, 21.5f, 21.0f, 20.5f, 20.0f, 19.5f,
		19.0f, 18.5f, 18.0f, 17.5f, 17.0f, 16.5f, 16.0f, 15.5f, 15.0f, 14.5f,
		14.0f, 13.5f, 13.0f, 12.5f, 12.0f, 11.5f, 11.0f, 10.5f, 10.0f, 9.5f,
		9.0f,  8.5f,  8.0f,  7.5f,  7.0f,  6.5f,  6.0f,  5.5f,  5.0f,  4.5f,
		4.0f,  3.5f,  3.0f,  2.5f,  2.0f,  1.5f,  1.0f,  0.5f
//		,  0.0f

};

static const float derivative_lut_values[MODEL_DERIVATIVE_LUT_SIZE] = {
		0.0210f, 0.0186f, 0.0162f, 0.0148f, 0.0156f, 0.0118f, 0.0104f, 0.0100f,
		0.0080f, 0.0068f, 0.0062f, 0.0056f, 0.0050f, 0.0044f, 0.0036f, 0.0044f,
		0.0030f, 0.0032f, 0.0014f, 0.0036f, 0.0024f, 0.0026f, 0.0018f, 0.0024f,
		0.0020f, 0.0024f, 0.0024f, 0.0038f, 0.0038f, 0.0036f, 0.0050f, 0.0056f,
		0.0062f, 0.0074f, 0.0074f, 0.0094f, 0.0086f, 0.0094f, 0.0098f, 0.0106f,
		0.0112f, 0.0112f, 0.0118f, 0.0124f, 0.0124f, 0.0124f, 0.0110f, 0.0124f,
		0.0112f, 0.0112f, 0.0112f, 0.0104f, 0.0094f, 0.0100f, 0.0092f, 0.0086f,
		0.0088f, 0.0074f, 0.0042f, 0.0044f, 0.0070f, 0.0080f, 0.0068f, 0.0074f,
		0.0068f, 0.0062f, 0.0076f, 0.0068f, 0.0074f, 0.0062f, 0.0080f, 0.0074f,
		0.0082f, 0.0080f, 0.0086f, 0.0076f, 0.0092f, 0.0080f, 0.0100f, 0.0092f,
		0.0100f, 0.0100f, 0.0110f, 0.0112f, 0.0118f, 0.0130f, 0.0144f, 0.0142f,
		0.0154f, 0.0150f, 0.0154f, 0.0136f, 0.0138f, 0.0136f, 0.0118f, 0.0118f,
		0.0112f, 0.0110f, 0.0112f, 0.0100f, 0.0098f, 0.0052f, 0.0054f, 0.0086f,
		0.0100f, 0.0086f, 0.0094f, 0.0086f, 0.0082f, 0.0086f, 0.0074f, 0.0082f,
		0.0068f, 0.0068f, 0.0074f, 0.0062f, 0.0074f, 0.0056f, 0.0068f, 0.0056f,
		0.0062f, 0.0062f, 0.0050f, 0.0056f, 0.0062f, 0.0050f, 0.0048f, 0.0056f,
		0.0050f, 0.0056f, 0.0056f, 0.0050f, 0.0056f, 0.0062f, 0.0048f, 0.0050f,
		0.0062f, 0.0056f, 0.0034f, 0.0034f, 0.0056f, 0.0062f, 0.0074f, 0.0062f,
		0.0082f, 0.0074f, 0.0086f, 0.0088f, 0.0086f, 0.0074f, 0.0082f, 0.0080f,
		0.0086f, 0.0094f, 0.0080f, 0.0094f, 0.0086f, 0.0092f, 0.0088f, 0.0092f,
		0.0088f, 0.0092f, 0.0088f, 0.0086f, 0.0100f, 0.0098f, 0.0112f, 0.0124f,
		0.0124f, 0.0124f, 0.0130f, 0.0118f, 0.0124f, 0.0130f, 0.0136f, 0.0132f,
		0.0142f, 0.0058f, 0.0060f, 0.0104f, 0.0088f, 0.0086f, 0.0074f, 0.0082f,
		0.0080f, 0.0086f, 0.0076f, 0.0092f, 0.0088f, 0.0104f, 0.0118f, 0.0162f,
		0.0236f, 0.0372f, 0.0440f, 0.0490f, 0.0544f, 0.0602f, 0.0664f, 0.0756f
//		,
//		0.0756f

};

float get_soc_from_ocv(float ocv){
	int index;
	float OCV=ocv;
	if(OCV>ocv_lut_values[0])
		OCV=ocv_lut_values[0];
	if(OCV<ocv_lut_values[MODEL_SOC_LUT_SIZE-1])
		OCV=ocv_lut_values[MODEL_SOC_LUT_SIZE-1];
	for(index=0;index<MODEL_OCV_LUT_SIZE;index++){
		if(OCV>=ocv_lut_values[index]){
			break;
		}
	}
	return soc_lut_values[index];
}

float get_ocv_from_soc(float soc){
	int index=0;
	if(soc>soc_lut_values[0])
		soc=soc_lut_values[0];
	if(soc<soc_lut_values[MODEL_SOC_LUT_SIZE-1])
		soc=soc_lut_values[MODEL_SOC_LUT_SIZE-1];
	index=binary_search(soc,soc_lut_values,MODEL_SOC_LUT_SIZE);
	return ocv_lut_values[index];
}

float get_ratio_from_soc(float soc){
	float docv;
	float ratio=0.0f;
//	float dsoc=0.0f;
	float SOC;
	SOC=soc;
	if(SOC>soc_lut_values[0]){
		SOC=soc_lut_values[0];
	}
	if(SOC<soc_lut_values[MODEL_OCV_LUT_SIZE-1]){
		SOC=soc_lut_values[MODEL_OCV_LUT_SIZE-1];
	}
	for(int i=0;i<MODEL_SOC_LUT_SIZE;i++){
		if(SOC>=soc_lut_values[i]){
			docv=(SOC-soc_lut_values[i])*derivative_lut_values[i];
			ratio=(ocv_lut_values[i]+docv)/SOC;
			break;
		}
	}
	return ratio;
}
#endif
